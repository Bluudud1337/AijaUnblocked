<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Media</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: Arial, sans-serif;
}

/* HEADER */
header {
  padding: 15px;
  background: #090009;
  display: flex;
  gap: 10px;
  position: sticky;
  top: 0;
  z-index: 10;
}

input {
  flex: 1;
  padding: 12px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  outline: none;
}

button {
  padding: 12px 20px;
  border-radius: 8px;
  border: none;
  background: #7f00ff;
  color: white;
  cursor: pointer;
}

button:hover {
  opacity: 0.85;
}

/* PLAYER */
#player iframe {
  width: 100%;
  height: 55vh;
  border: none;
  background: black;
}

/* RESULTS */
#results {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px,1fr));
  gap: 15px;
  padding: 15px;
}

.video {
  background: #12001f;
  border-radius: 10px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.15s ease;
}

.video:hover {
  transform: scale(1.04);
}

.video img {
  width: 100%;
  display: block;
}

.video p {
  font-size: 14px;
  padding: 8px;
  margin: 0;
}
</style>
</head>

<body>

<header>
  <input id="q" placeholder="Search videos…" />
  <button onclick="search()">Search</button>
</header>

<div id="player"></div>
<div id="results"></div>

<script>
/* ===== PIPED FALLBACK SYSTEM ===== */
const PIPED_APIS = [
  "https://pipedapi.syncpundit.io",
  "https://pipedapi.adminforge.de",
  "https://pipedapi.rivo.lol",
  "https://api-piped.mha.fi"
];

let apiIndex = 0;

async function fetchPiped(path) {
  for (let i = 0; i < PIPED_APIS.length; i++) {
    const api = PIPED_APIS[apiIndex];
    try {
      const res = await fetch(api + path);
      if (!res.ok) throw new Error();
      return await res.json();
    } catch {
      apiIndex = (apiIndex + 1) % PIPED_APIS.length;
    }
  }
  throw new Error("No services available");
}

/* ===== SEARCH ===== */
async function search() {
  const query = document.getElementById("q").value.trim();
  if (!query) return;

  document.getElementById("results").innerHTML = "<p>Searching…</p>";
  document.getElementById("player").innerHTML = "";

  try {
    const data = await fetchPiped(
      `/search?q=${encodeURIComponent(query)}&filter=videos`
    );

    const results = document.getElementById("results");
    results.innerHTML = "";

    if (!data.items || !data.items.length) {
      results.innerHTML = "<p>No results found.</p>";
      return;
    }

    data.items.slice(0, 30).forEach(v => {
      const card = document.createElement("div");
      card.className = "video";
      card.innerHTML = `
        <img src="${v.thumbnail}">
        <p>${v.title}</p>
      `;
      card.onclick = () => playVideo(v.id);
      results.appendChild(card);
    });

  } catch (err) {
    document.getElementById("results").innerHTML =
      "<p>No services available.</p>";
  }
}

/* ===== PLAYER ===== */
function playVideo(id) {
  document.getElementById("player").innerHTML = `
    <iframe
      src="https://piped.video/embed/${id}"
      allowfullscreen
      referrerpolicy="no-referrer">
    </iframe>
  `;
}

/* ENTER KEY SUPPORT */
document.getElementById("q").addEventListener("keydown", e => {
  if (e.key === "Enter") search();
});
</script>

</body>
</html>
