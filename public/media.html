<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crimson watch</title>

<style>
:root {
  --bg: #07070c;
  --card: #141427;
  --purple: #8b5cf6;
  --text: #e5e7eb;
}

* {
  box-sizing: border-box;
  font-family: system-ui, sans-serif;
}

body {
  margin: 0;
  background: linear-gradient(180deg, #0b0b18, #050507);
  color: var(--text);
}

/* SEARCH */
.search-container {
  padding: 20px;
  display: flex;
  justify-content: center;
}

.search-bar {
  width: min(650px, 92%);
  padding: 14px 20px;
  border-radius: 999px;
  border: none;
  outline: none;
  background: var(--card);
  color: var(--text);
  font-size: 16px;
}

/* PLAYER */
.player-wrapper {
  max-width: 1100px;
  margin: 0 auto 25px;
  padding: 0 16px;
}

iframe {
  width: 100%;
  aspect-ratio: 16 / 9;
  border-radius: 16px;
  border: none;
  background: black;
}

/* STATUS */
.status {
  text-align: center;
  font-size: 13px;
  opacity: 0.7;
  margin-bottom: 10px;
}

/* GRID */
.video-grid {
  max-width: 1300px;
  margin: 0 auto;
  padding: 0 16px 40px;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
}

.video-card {
  background: var(--card);
  border-radius: 14px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.video-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 25px rgba(139,92,246,0.25);
}

.thumbnail {
  width: 100%;
  aspect-ratio: 16 / 9;
  object-fit: cover;
}

.video-info {
  padding: 10px;
}

.video-title {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.3;
}

/* RESPONSIVE */
@media (max-width: 1100px) {
  .video-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 600px) {
  .video-grid { grid-template-columns: 1fr; }
}
</style>
</head>

<body>

<div class="search-container">
  <input
    id="searchInput"
    class="search-bar"
    placeholder="Search videos…"
  />
</div>

<div class="player-wrapper">
  <iframe id="player" allowfullscreen></iframe>
</div>

<div class="status" id="status">Loading…</div>
<div class="video-grid" id="videoGrid"></div>

<script>
/* ===== SOURCES (AUTO FALLBACK) ===== */
const SOURCES = [
  { type: "piped", url: "https://piped.video" },
  { type: "piped", url: "https://piped.projectsegfau.lt" },
  { type: "invidious", url: "https://yewtu.be" },
  { type: "invidious", url: "https://vid.puffyan.us" }
];

const player = document.getElementById("player");
const grid = document.getElementById("videoGrid");
const status = document.getElementById("status");
const searchInput = document.getElementById("searchInput");

async function searchVideos(query) {
  status.textContent = "Searching…";
  grid.innerHTML = "";

  for (const src of SOURCES) {
    try {
      const api = `${src.url}/api/v1/search?q=${encodeURIComponent(query)}&type=video`;
      const res = await fetch(api);
      if (!res.ok) throw new Error("Blocked");

      const data = await res.json();
      renderResults(data, src);
      status.textContent = `Source: ${src.url}`;
      return;

    } catch (err) {
      console.warn("Failed:", src.url);
    }
  }

  status.textContent = "All sources blocked or unavailable.";
}

function renderResults(data, src) {
  const items = data.items || data;
  grid.innerHTML = "";

  items.slice(0, 8).forEach((v, i) => {
    const id = v.id || v.videoId;
    const title = v.title;
    const thumb =
      v.thumbnail ||
      (v.videoThumbnails && v.videoThumbnails.at(-1)?.url);

    const card = document.createElement("div");
    card.className = "video-card";

    card.innerHTML = `
      <img class="thumbnail" src="${thumb}">
      <div class="video-info">
        <div class="video-title">${title}</div>
      </div>
    `;

    const embedUrl =
      src.type === "piped"
        ? `${src.url}/embed/${id}`
        : `${src.url}/embed/${id}`;

    card.onclick = () => {
      player.src = embedUrl;
      window.scrollTo({ top: 0, behavior: "smooth" });
    };

    grid.appendChild(card);

    if (i === 0) {
      player.src = embedUrl;
    }
  });
}

searchInput.addEventListener("keydown", e => {
  if (e.key === "Enter" && searchInput.value.trim()) {
    searchVideos(searchInput.value.trim());
  }
});

/* DEFAULT LOAD */
searchVideos("trending");
</script>

</body>
</html>
